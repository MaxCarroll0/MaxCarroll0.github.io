### Configuration file for the soupault website generator ###

## Global settings

[settings]
  # Require soupault 5.1.0 or later
  soupault_version = "5.1.0"

  # Show build progress
  verbose = true

  # Show detailed debug information
  debug = true

  # Fail on page processing errors
  strict = true

  # Where generated files go
  build_dir = "build/"

  # Where page files are stored
  site_dir = "site/"

  # HTML page skeleton file to insert content into
  default_template_file = "templates/main.html"

  # Insert the content in <main>, after existing children (if any)
  default_content_selector = "main"
  default_content_action = "append_child"

  # Page considered the section index
  index_page = "index"

  # Extensions of files considered pages rather than assets
  page_file_extensions = ["htm", "html", "md"]

  # Extensions of files to be converted from Markdown to HTML
  # using the built-in Markdown processor
  markdown_extensions = ["md"]

  doctype = "<!DOCTYPE html>"

  # Automatically load Lua plugins from plugins/
  # E.g. plugins/reading-time.lua is automatically loaded as "reading-time" widget.
  plugin_discovery = true
  plugin_dirs = ["plugins"]

# Options in the [custom_options] table aren't soupault built-ins.
# It's a table for options that can be shared between multiple plugins.
[custom_options]

  # Number of "lastest post" to display on the main page
  blog_summary_max_entries = 10

  ## Atom feed settings
  atom_feeds = false

  # If you want to generate Atom feeds, you will need to adjust the site metadata config below:

  # Required:
  # site_url = "https://www.example.com/~jrandomhacker"

  # Optional but strongly recommended:
  # site_author = "J. Random Hacker"
  # site_author_email = "jrandomhacker@example.com"
  # site_title = "My website"
  # site_logo = "https://example.com/~jrandomhacker/favicon.png"

  # Completely optional: 
  # site_subtitle = "Some subtitle"

# Autogenerated section blog index settings
[index]
  index = true

  sort_descending = true

  extract_after_widgets = ['insert-reading-time', 'make-post-header', 'make-paper-header']

  sort_by = "date"

  # A directory with a .leaf file in it is treated as hand-made "clean URL",
  # rather than a section.
  leaf_file = ".leaf"

[index.fields]
  # blogs
  post_title = { selector = ["#post-title", "h1"] }
  post_excerpt = { selector = ["#post-excerpt", "p"] }
  post_date = { selector = ["#post-date", "time"] }
  post_tags = { selector = ".post-tag", select_all = true }

  post_reading_time = { selector = "#post-reading-time" }

  # papers
  paper_title = { selector = ["#paper-title", "h1"] }
  paper_date = { selector = ["#paper-date", "time"] }
  paper_conference = { selector = ["#paper-conference"] }
  paper_abstract = { selector = ["#paper-abstract", "p"] }
  paper_authors = { selector = ".paper-author", select_all = true }  
  paper_keywords = { selector = ".paper-keyword", select_all = true }  

  paper_artifacts = { selector = ".paper-artifact", select_all = true }

  paper_pages = { selector = "#paper-pages" }


[index.views.blog-index]
  # Insert generated index into an element that matches "#blog-index" selector.
  index_selector = "#blog-entries"

  # Only extract metadata from pages in site/blog/*
  section = "blog"

  # Jingoo template for rendering extracted metadata
  index_template = """
    {% for e in entries %}
    <h2><a href="{{e.url}}">{{e.post_title}}</a></h2>
    <div><strong>Last update:</strong> {{e.post_date}}</div>
    {% if e.post_tags %}
    <div class="post-tags">
       <strong>Tags: </strong>
       {%- for tag in e.post_tags -%}
         <a href="/blog/tag/{{tag}}"><span class="post-tag">{{tag}}</span></a>{% if not loop.last %}, {% endif %}
       {%- endfor -%}
    </div>
    {% endif %}
    <div><strong>Reading time:</strong> {{e.post_reading_time}}</div>
    <p>{{e.post_excerpt}}</p>
    <a href="{{e.url}}">Read more</a>
    {% endfor %}
  """

  # Override soupault's built-in index processor with a custom Lua script.
  # That script is written to mimic the built-in indexer behavior,
  # it will take a template from the index_template option.
#  file = "helpers/blog-index.lua"


# This view displays the first ten entries on the main page
[index.views.blog-summary]
  index_selector = "#latest-blog-entries"

  section = "blog"

  # In this case index_template is a soupault built-in
  index_template = """
    {% set limit = int(soupault_config.custom_options.blog_summary_max_entries) %}
    <dl>
      {% for e in sublist(0, limit, entries) %}
      <dt>{{e.date}}</dt>
      <dd> <a href="{{e.url}}">{{e.post_title}}</a> </dd>
      {% endfor %}
      </ul>
    </dl>
  """

[index.views.papers-index]
  index_selector = "#paper-entries"

  ## Extract metadata from site/papers
  section = "papers"

  # Jingoo template for rendering extracted metadata
  index_template = """
    {% for e in entries %}
    <h2><a href="{{e.url}}">{{e.paper_title}}</a>[<a href="{{e.conference_url}}">{{e.conference}}</a>]</h2>
    <div><strong>Date:</strong> {{e.paper_date}}</div>
    {% if e.paper_authors %}
    <div class="paper-authors">
       <strong>Authors: </strong>
       {%- for author in e.paper_authors -%}
         {{author}}{% if not loop.last %}, {% endif %}
       {%- endfor -%}
    </div>
    {% endif %}
    <div><strong>Pages:</strong> {{e.paper_pages}}</div>
    {% if e.paper_artifacts %}
    <div class="paper-artifacts">
       <strong>Artifacts: </strong>
       {%- for artifact in e.paper_artifacts -%}
        {{artifact}}{% if not loop.last %}, {% endif %}
       {%- endfor -%}
    </div>
    {% endif %}

    {% if e.paper_keywords %}
    <div class="post-tagss">
       <strong>Keywords: </strong>
       {%- for keyword in e.paper_keywords -%}
         <a href="site/papers/{{keyword}}"><span class="keyword">{{keyword}}</span></a>{% if not loop.last %}, {% endif %}
       {%- endfor -%}
    </div>
    {% endif %}
    {% endfor %}
  """

## Plugins
[plugins.git-timestamp]
  file = "plugins/git-timestamp.lua"

## Widgets
# Takes the content of the first #page-title element or <h1> and inserts it into the <title>
# default is used if page has no elements matching those selectors.
[widgets.set-page-title]
  widget = "title"

  # Must run only after the header with an <h1 id="post-title"> element is inserted, which affects the blog section pages
  after = ['make-post-header', 'make-paper-header']

  selector = ["#page-title", "h1"]
  default = "Max Carroll's Personal Website"
  append = " &mdash; Max Carroll"

# Add link to git
[widgets.source-link]
  widget = "source-link"
  selector = "div#source-link"
  link_text = "Source link for this page"
  repo_base = "https://github.com/MaxCarroll0/MaxCarroll0.github.io/tree/main"

# Git update time
[widgets.last-modified]
  widget = "git-timestamp"
  timestamp_container_selector = "body"
  manual_timestamp_selector = "time#last-modified"
  timestamp_format = "Last modified on %s"
  git_date_format = "short"


# Inserts the contents of templates/header.html right before the <main> element
# There's a variety of actions, including prepend_child and replace_content
[widgets.insert-header]
  widget = "include"

  selector = "main"
  action = "insert_before"
  file = "templates/header.html"

# This widget comes from plugins/section-link-highlight.lua
# It highlights the "active" link in the navigation menu,
# that is, the link that matches the current page URL
[widgets.highlight-active-link]
  widget = "section-link-highlight"

  # Must run only after the header with a navigation menu is inserted
  after = ["insert-header"]

  selector = "nav"
  active_link_class = "nav-active"

# Creates a table of contents from the page headings
# and inserts it in the element with id="sidebar" as per the selector and action options.
[widgets.toc]
  widget = "toc"

  selector = "#sidebar"
  action = "prepend_child"

  min_level = 2
  max_level = 3

  toc_list_class = "toc"
  toc_class_levels = false

  # Insert a link to the current section next to each heading for easy copying.
  # When ids are persistent, deep linking is not bad, it's great.
  heading_links = true
  heading_link_class = "here"
  heading_link_text = "# "

  # Use slugified <h*> tag content for the id
  # is a heading doesn't have an id attribute.
  #
  # If a heading does have an id, like <h2 id="ip-route">
  # that id is preserved and used in the ToC link.
  use_heading_slug = true

  # Wrap every sub-list in a <li>, as the HTML standard demands.
  valid_html = true


# This widget comes from plugins/collapsible-list.lua
#
# It converts nested <ul>/<ol> elements to a tree with foldable nodes
# using HTML5 <details>/<summary> elements.
[widgets.toc-collapse]
  after = "toc"
  widget = "collapsible-list"
  collapsible_class = "collapsible"



# Having chunks of the page wrapped in <div> or some other block elements
# make styling a lot simpler.
# However, writing those wrapper elements by hand is annoying.
# That's where the plugin from plugins/wrap-sections.lua comes into play.
#
# Here it takes this:
#
# <h3>First heading</h3>
# <p>First paragraph</p>
# <h3>Second heading</h3>
# <p>First paragraph</p>
#
# and converts it to this:
#
# <div class="subsection">
#   <h3>First heading</h3>
#   <p>First paragraph</p>
# </div>
# <div class="subsection">
#  <h3>Second heading</h3>
# ...
[widgets.wrap-subsections]
  widget = "wrap-sections"
  selector = "main"
  wrapper_element = "div"
  level = 3
  class = "subsection"

# Same, but for the <h2> level
# One use for it is the different background color for even subsections of a section.
# Applying :nth-child(even) to subsections without wrapping them in section may create an awkward look
# when a previous section has an odd number of subsections: in that case it's the _first_ child
# that ends up colored differently.
# The only way to prevent that is to make all subsection elements children of a single parent.
[widgets.wrap-sections]
  widget = "wrap-sections"
  selector = "main"
  wrapper_element = "div"
  level = 2
  class = "section"

# Inserts the contents of templates/footer.html at the end of the <body>
[widgets.insert-footer]
  widget = "include"
  selector = "body"
  action = "append_child"
  file = "templates/footer.html"

[widgets.make-post-header]
  widget = "post-header"
  section = "blog/"
  exclude_page = "blog/index.md"

  content_container_selector = "main"

  post_header_template = '''
    <div id="post-header">
      <h1 id="post-title">{{title}}</h1>
      <div><strong>Last update:</strong> <time id="post-date" datetime="{{date}}">{{date}}</time></div>
      {% if tags %}
        <div class="post-tags">
         <span><strong>Tags:</strong> </span>
         {%- for t in tags -%}
           <a href="/blog/tag/{{t}}"><span class="post-tag">{{t}}</span></a>{% if not loop.last %}, {% endif %}
         {%- endfor -%}
         </div>
        {% endif %}
    </div>
'''

[widgets.make-paper-header]
  widget = "paper-header"
  section = "papers/"
  exclude_page = "papers/index.md"

  content_container_selector = "main"

  paper_header_template = '''
    <div id="paper-header">
      <h1 id="paper-title">{{title}}</h1>
      <div><strong>Published:</strong> <time id="paper-date" datetime="{{date}}">{{date}}</time> in <strong><a href="{{conference_url}}" id="paper-conference">{{conference}}</a></strong></div>
      <div><strong>Pages:</strong> <span id="paper-pages">{{pages}}</span></div>
      {% if authors %}
        <div class="authors">
         <span><strong>Authors:</strong> </span>
         {%- for author in authors -%}
           <span class="paper-author"><a href="{{author[1]}}">{{author[0]}}</a></span>{% if not loop.last %}, {% endif %}
         {%- endfor -%}
         </div>
        {% endif %}
      {% if artifacts %}
        <div class="paper-artifacts">
         <span><strong>Artifacts:</strong> </span>
         {%- for artifact in artifacts -%}
           <span class="paper-artifact"><a><span>{{artifact[0]}}, {{artifact[1]}}</a></span>{% if not loop.last %}, {% endif %}
         {%- endfor -%}
         </div>
        {% endif %}
      {% if keywords %}
        <div class="paper-keywords">
         <span><strong>Keywords:</strong> </span>
         {%- for keyword in keywords -%}
           <a href="/papers/keywords/{{keyword}}"><span class="paper-keyword">{{keyword}}</span></a>{% if not loop.last %}, {% endif %}
         {%- endfor -%}
         </div>
        {% endif %}
      <h2>Abstract</h2>
      <p id="paper-abstract">{{abstract}}</p>
    </div>
'''



# Why require adding a target element for the reading-time plugin by hand?
# We'll insert it automatically
[widgets.insert-reading-time-container]
  widget = "insert_html"

  after = "make-post-header"

  # Reading time container should only be in blog/*
  section = "blog/"

  # ...but not in blog/index.html
  exclude_path_regex = "(.*)/index(.*)"

  # Insert the reading time container right after the post title in <h1>
  action = "append_child"
  selector = "#post-header"

  html = '<div><strong>Reading time:</strong> <span id="post-reading-time"></span></div>'

# This widget comes from plugins/reading-time.lua
# It calculates estimated reading time based on word count
[widgets.insert-reading-time]
  widget = "reading-time"

  # If this widget runs before "insert-reading-time-container",
  # there will be nowhere to insert the reading time.
  # This is why we explicitly schedule it to run after that widget.
  after = "insert-reading-time-container"

  selector = "#post-reading-time"

  # The element where it looks for page "content"
  content_selector = "main"

# Inserts a table of contents generated from page headings
[widgets.table-of-contents]
  #exclude_path_regex = '/index(.*)'

  widget = "toc"
  selector = "#generated-toc"

  min_level = 2

  toc_list_class = "toc"
  toc_class_levels = false

  valid_html = true

  numbered_list = true

  heading_links = true
  heading_link_text = "â†’ "
  heading_link_class = "here"

  use_heading_slug = true

[widgets.list-to-tree]
  widget = "collapsible-list"
  selector = ["ul.tree", "ol.tree"]
  collapsible_class = "collapsible"


[widgets.insert-footnotes-container]
  widget = "insert-if"

  selector = "main"
  check_selector = "fn"
  html = '<div id="footnotes"> </div>'

[widgets.footnotes]
  widget = "footnotes"

  after = "insert-footnotes-container"

  selector = "div#footnotes"
  footnote_selector = ["fn"]
  footnote_link_class = "footnote"
  back_links = true
  link_id_prepend = "footnote-"
  back_link_id_append = "-ref"

[widgets.atom]
  widget = "atom"
  page = "blog/index.md"
  feed_file = "atom.xml"
  use_section = "blog"
